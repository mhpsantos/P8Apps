var s=require("Storage");eval(s.read("widgets.js"));var y_wg_bottom=g.getHeight()-25,y_wg_top=24,apps=s.list(/\.info$/).map(function(a){return(a=s.readJSON(a,1))&&{name:a.name,type:a.type,icon:a.icon,sortorder:a.sortorder,src:a.src}}).filter(function(a){return a&&("app"==a.type||"clock"==a.type||!a.type)});apps.sort(function(a,b){var c=(0|a.sortorder)-(0|b.sortorder);return c?c:a.name<b.name?-1:a.name>b.name?1:0});var Napps=apps.length,Npages=Math.ceil(Napps/6),maxPage=Npages-1,selected=-1,page=0;
function draw_icon(a,b,c){var d=b%3*80,e=2<b?130:40;(c?g.setColor(.7,.7,.7):g.setColor(0,0,0)).fillRect(d,e,d+79,e+89);g.drawImage(s.read(apps[6*a+b].icon),d+10,e+10,{scale:1.25});g.setColor(-1).setFontAlign(0,-1,0).setFont("6x8",1).drawString(apps[6*a+b].name,d+40,e+74)}
function drawPage(a){g.setColor(0,0,0).fillRect(0,y_wg_top,239,y_wg_bottom);P8.drawWidgets();g.setFont("6x8",2).setFontAlign(0,-1,0).setColor(1,1,1).drawString("Apps ("+(a+1)+"/"+Npages+")",120,y_wg_top+2);for(var b=0;6>b;b++){if(!apps[6*a+b])return b;draw_icon(a,b,!1)}}TC.on("swipe",function(a){selected=-1;a==TC.LEFT?(++page,page>maxPage&&(page=maxPage),drawPage(page)):a==TC.RIGHT&&(--page,0>page&&(page=0),drawPage(page))});
function isTouched(a,b){if(0>b||5<b)return!1;var c=b%3*80,d=2<b?130:40;return a.x>c&&a.y>d&&a.x<c+79&&a.y<d+89}TC.on("touch",function(a){var b;for(b=0;6>b;b++)if(6*page+b<Napps&&isTouched(a,b)){draw_icon(page,b,!0);0<=selected&&(selected!=b?draw_icon(page,selected,!1):D17.read()?reset():load(apps[6*page+b].src));selected=b;break}(6==b||6*page+b>Napps)&&0<=selected&&(draw_icon(page,selected,!1),selected=-1)});P8.loadWidgets();setTimeout(function(){drawPage(0)},1E3);
